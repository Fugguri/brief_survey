# üá∫üá∏ English

# BriefSurvey
Universal Dynamic Survey for Telegram Bots with `aiogram_dialog` and Pydantic
## Description
BriefSurvey is a module for quick and flexible creation of dialog-based surveys in Telegram using aiogram v3 and aiogram_dialog.

- Questions are defined using Pydantic models to enforce strong typing and validation.
- Final answers are automatically serialized back into a Pydantic result model.
- Easy to extend and customize.
- Supports different question types: text, number, single-choice, multiple-choice.
- Simple integration and handler registration.

---
# Installation
## From GitHub Repository

```bash
pip install git+https://github.com/Fugguri/brief_survey.git 
```
## Download Locally and Install

```bash
git clone https://github.com/Fugguri/brief_survey.git
pip install -e brief_survey 
```


## Quick Start
### 1. Define your questions using Pydantic models:

```python
from brief_survey import QuestionBase, ChoiceQuestion, MultiChoiceQuestion

questions = [
    QuestionBase(
        name="name",
        text="What is your name?",
        type="text",
        validator=lambda x: bool(x.strip()),
    ),
    ChoiceQuestion(
        name="gender",
        text="Select your gender",
        type="choice",
        choices=[("1", "Male"), ("2", "Female")],
    ),
    MultiChoiceQuestion(
        name="profession",
        text="Select your profession",
        type="multi_choice",
        choices=[
            ("1", "Athlete"),
            ("2", "Entrepreneur"),
            ("3", "Worker"),
        ],
    ),
]
```
# 2. Define a result model:
``` python
from pydantic import BaseModel
from typing import Optional

class SurveyResult(BaseModel):
    name: Optional[str]
    gender: Optional[str]
    profession: Optional[list[str]]
```
# 3. Create a function to save results:
``` python
async def save_handler(user_id: int, result: SurveyResult):
    # Save logic, e.g., store in database
    print(f"User {user_id} survey result: {result}")

```
# 4. Initialize and register the survey:
``` python
from brief_survey import BriefSurvey

survey = BriefSurvey(
    questions=questions,
    save_handler=save_handler,
    result_model=SurveyResult,
)

# In your main bot file with Dispatcher dp
survey.register_handlers(
    dp=dp,
    command_start='start_survey',     # optional
    text='Start survey',               # optional
    callback_data="start_survey"       # optional
)
```
# 5. Launch the survey in Telegram with the command:
 /start_survey

# Important
If you have global handlers in your bot, filter states explicitly using StateFilter to avoid conflicts that can break the survey after the first message:
``` python
from aiogram.filters import StateFilter

dp.message.register(handle, StateFilter(None))          # Only outside states
dp.callback_query.register(handle_callback, StateFilter(None))
```

# üá∑üá∫ –†—É—Å—Å–∫–∏–π

# BriefSurvey

–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –æ–ø—Ä–æ—Å–Ω–∏–∫ –¥–ª—è Telegram-–±–æ—Ç–æ–≤ –Ω–∞ –±–∞–∑–µ `aiogram_dialog` —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π Pydantic-–º–æ–¥–µ–ª–µ–π –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤.

---

## –û–ø–∏—Å–∞–Ω–∏–µ

BriefSurvey ‚Äî —ç—Ç–æ –º–æ–¥—É–ª—å –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –∏ –≥–∏–±–∫–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–∏–∞–ª–æ–≥–æ–≤—ã—Ö –æ–ø—Ä–æ—Å–Ω–∏–∫–æ–≤ –≤ Telegram —Å –ø–æ–º–æ—â—å—é `aiogram` 3-–π –≤–µ—Ä—Å–∏–∏ –∏ `aiogram_dialog`.

- –í–æ–ø—Ä–æ—Å—ã –æ–ø–∏—Å—ã–≤–∞—é—Ç—Å—è Pydantic-–º–æ–¥–µ–ª—è–º–∏ –¥–ª—è —Å—Ç—Ä–æ–≥–æ–π —Ç–∏–ø–∏–∑–∞—Ü–∏–∏ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏.
- –ò—Ç–æ–≥–æ–≤—ã–µ –æ—Ç–≤–µ—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–µ—Ä–∏–∞–ª–∏–∑—É—é—Ç—Å—è –æ–±—Ä–∞—Ç–Ω–æ –≤ Pydantic-–º–æ–¥–µ–ª—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞.
- –õ–µ–≥–∫–æ —Ä–∞—Å—à–∏—Ä—è–µ—Ç—Å—è –∏ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è.
- –ü–æ–∑–≤–æ–ª—è–µ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ–ø—Ä–æ—Å–Ω–∏–∫ —Å —Ä–∞–∑–Ω—ã–º–∏ —Ç–∏–ø–∞–º–∏ –≤–æ–ø—Ä–æ—Å–æ–≤: —Ç–µ–∫—Å—Ç, —á–∏—Å–ª–æ, –≤—ã–±–æ—Ä –æ–¥–Ω–æ–≥–æ –∏–ª–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤.
- –ü—Ä–æ—Å—Ç–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤.

---

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞
## Github Repo
```bash
pip install git+https://github.com/Fugguri/brief_survey.git 
```
## –°–∫–∞—á–∞—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å
```bash
git clone https://github.com/Fugguri/brief_survey.git
pip install -e brief_survey 
```


## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
### 1. –û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ –≤–æ–ø—Ä–æ—Å—ã (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Pydantic-–º–æ–¥–µ–ª–∏):

```python
from brief_survey import QuestionBase, ChoiceQuestion, MultiChoiceQuestion

questions = [
    QuestionBase(
        name="name",
        text="–ö–∞–∫ –≤–∞—Å –∑–æ–≤—É—Ç?",
        type="text",
        validator=lambda x: bool(x.strip()),
    ),
    ChoiceQuestion(
        name="gender",
        text="–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª",
        type="choice",
        choices=[("1", "–ú—É–∂—Å–∫–æ–π"), ("2", "–ñ–µ–Ω—Å–∫–∏–π")],
    ),
    MultiChoiceQuestion(
        name="gender",
        text="–í—ã–±–µ—Ä–∏—Ç–µ —Ä–æ–¥ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏",
        type="multi_choice",
        choices=[("1", "–°–ø–æ—Ä—Ç—Å–º–µ–Ω"), 
                 ("2", "–ü—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª—å"),
                 ("3", "–ü—Ä–æ—Å—Ç–æ–π —Ä–∞–±–æ—Ç–Ω–∏–∫")
                 ],
    )
]
```
# 2. –û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ –º–æ–¥–µ–ª—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞:
``` python
from pydantic import BaseModel
from typing import Optional


class SurveyResult(BaseModel):
    name: Optional[str]
    gender: Optional[str]
```
# 3. –°–æ–∑–¥–∞–π—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:
```python
async def save_handler(user_id: int, result: SurveyResult):
    # –õ–æ–≥–∏–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è, –Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ –±–∞–∑—É
    print(f"–†–µ–∑—É–ª—å—Ç–∞—Ç –æ–ø—Ä–æ—Å–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {user_id}: {result}")
```
# 4. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ –∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ –æ–ø—Ä–æ—Å–Ω–∏–∫:
``` python
from brief_survey import BriefSurvey

survey = BriefSurvey(
    questions=questions,
    save_handler=save_handler,
    result_model=SurveyResult,
)

# –≤ –æ—Å–Ω–æ–≤–Ω–æ–º —Ñ–∞–π–ª–µ —Å –±–æ—Ç–æ–º (Dispatcher dp) —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –≤ Dispatcher
survey.register_handlers(dp=dp,
                         command_start='start_survey', #–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
                         text='–ù–∞—á–∞—Ç—å –æ–ø—Ä–æ—Å', #–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
                         callback_data="start_survey" #–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
                         )
```
# 5.–ó–∞–ø—É—Å–∫–∞–π—Ç–µ –∫–æ–º–∞–Ω–¥—É –≤ Telegram:
/start_survey

# –í–∞–∂–Ω–æ.
–ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—ã–π handler, —Ñ–∏–ª—å—Ç—Ä—É–π—Ç–µ state –≤—Ä—É—á–Ω—É—é, –ø—Ä–∏ –ø–æ–º–æ—â–∏ StateFilter.–ù–µ—è—Å–Ω—ã–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã –∏ –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–ø—Ä–æ—Å–Ω–∏–∫ –ø–µ—Ä–µ—Å—Ç–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å.

``` python
from aiogram.filters import StateFilter
dp.message.register(handle,StateFilter(None))  # —Ç–æ–ª—å–∫–æ –≤–Ω–µ —Å–æ—Å—Ç–æ—è–Ω–∏–π!
dp.callback_query.register(handle_callback,StateFilter(None))
```


# ToDo
- –§—É–Ω–∫—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—è `survey.add_field(*args,**kwargs)` —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π.(–ù–æ —ç—Ç–æ –Ω–µ —Ç–æ—á–Ω–æüòá)